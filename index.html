<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Interview Prep Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Vapi SDK for voice calls -->
    <script src="https://cdn.jsdelivr.net/gh/balacodeio/Vapi-Web-UMD@latest/dist/latest/vapi-web-bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 60px 20px 40px;
            border-bottom: 1px solid #333;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #999;
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .scenario-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2);
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .company-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
        }

        .difficulty-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difficulty-hard {
            background: #e53e3e33;
            color: #fc8181;
            border: 1px solid #e53e3e;
        }

        .difficulty-medium {
            background: #ed8a3633;
            color: #f6ad55;
            border: 1px solid #ed8a36;
        }

        .scenario-description {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .scenario-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .detail-item {
            margin: 12px 0;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .detail-label {
            color: #667eea;
            font-weight: 600;
            min-width: 80px;
        }

        .detail-value {
            color: #999;
            flex: 1;
        }

        .start-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .start-button:hover {
            transform: translateY(-2px);
        }

        .back-button {
            background: #333;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            transition: background 0.2s;
        }

        .back-button:hover {
            background: #444;
        }

        .briefing-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 40px;
            margin: 30px 0;
            border: 1px solid #333;
        }

        .briefing-header {
            margin-bottom: 30px;
        }

        .briefing-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .briefing-header p {
            color: #999;
            font-size: 1.1rem;
        }

        .briefing-box {
            background: #0d1117;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .briefing-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .briefing-box p {
            color: #ccc;
            margin: 10px 0;
            line-height: 1.8;
        }

        .briefing-box ul {
            margin: 15px 0 15px 20px;
            color: #ccc;
        }

        .briefing-box li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .personas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .persona-card {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .persona-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .persona-role {
            color: #999;
            font-size: 0.9rem;
        }

        .chat-container {
            background: #1a1a1a;
            border-radius: 12px;
            border: 1px solid #333;
            margin: 30px 0;
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            background: #0d1117;
            border-radius: 12px 12px 0 0;
        }

        .chat-header h3 {
            color: #fff;
            margin-bottom: 10px;
        }

        .participants {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .participant {
            background: #1a1a1a;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #999;
            border: 1px solid #333;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .speaker-name {
            font-weight: 600;
            color: #667eea;
        }

        .speaker-name.user {
            color: #48bb78;
        }

        .message-content {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            line-height: 1.8;
        }

        .message.user .message-content {
            border-left-color: #48bb78;
        }

        .input-section {
            padding: 20px;
            border-top: 1px solid #333;
            background: #0d1117;
            border-radius: 0 0 12px 12px;
        }

        .input-container {
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            color: #e0e0e0;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .send-button:hover {
            background: #5568d3;
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .end-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }

        .end-button:hover {
            background: #c53030;
        }

        .feedback-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 40px;
            margin: 30px 0;
            border: 1px solid #333;
        }

        .feedback-section h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .feedback-content {
            background: #0d1117;
            padding: 25px;
            border-radius: 8px;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .loading {
            color: #999;
            font-style: italic;
        }

        .warning {
            background: #2d1f1f;
            border: 1px solid #e53e3e;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #fc8181;
        }

        .info-box {
            background: #1f2d3d;
            border: 1px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #9bb5e0;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid #667eea;
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            color: #fff;
            margin-bottom: 20px;
        }

        .modal-content p {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .api-key-input {
            width: 100%;
            background: #0d1117;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            color: #e0e0e0;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-button-primary:hover {
            transform: translateY(-2px);
        }

        .modal-button-secondary {
            background: #333;
            color: white;
        }

        .modal-button-secondary:hover {
            background: #444;
        }

        .api-key-link {
            color: #667eea;
            text-decoration: none;
        }

        .api-key-link:hover {
            text-decoration: underline;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .mode-button {
            padding: 12px 30px;
            border-radius: 8px;
            border: 2px solid #333;
            background: #1a1a1a;
            color: #999;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .mode-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .mode-button:hover:not(.active) {
            border-color: #667eea;
            color: #667eea;
        }

        .voice-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            padding: 30px;
        }

        .voice-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            color: #ccc;
        }

        .voice-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }

        .voice-indicator.active {
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .voice-button {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .voice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
        }

        .voice-button.active {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .voice-button.active:hover {
            box-shadow: 0 6px 20px rgba(229, 62, 62, 0.4);
        }

        .voice-transcript {
            background: #0d1117;
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            width: 100%;
            margin-top: 20px;
        }

        .transcript-item {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 3px solid #667eea;
            background: #1a1a1a;
            border-radius: 4px;
        }

        .transcript-item.user {
            border-left-color: #48bb78;
        }

        .transcript-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .transcript-label.user {
            color: #48bb78;
        }

        .api-key-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 1px solid #48bb78;
            border-radius: 8px;
            padding: 10px 20px;
            color: #48bb78;
            font-size: 0.9rem;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SCENARIO CONFIGURATIONS
        const SCENARIOS = {
            cursor: {
                id: 'cursor',
                company: 'Cursor',
                companyDescription: 'AI-first code editor',
                difficulty: 'hard',
                description: 'Navigate a hostile security conversation to discover an engineering reorg and position Cursor as the solution for velocity during organizational change.',
                targetAccount: 'Figma',
                personas: [
                    { name: 'Sarah Chen', role: 'VP of Engineering' },
                    { name: 'Marcus Rodriguez', role: 'Head of Security' }
                ],
                yourRole: 'Account Executive at Cursor',
                initialStance: 'Hostile - want to remove Cursor immediately due to security concerns',
                hiddenContext: 'Figma is going through a major engineering reorganization. Teams are being restructured, velocity is suffering, and some engineers found Cursor on their own to stay productive.',
                successCriteria: 'Discover the reorg pain, connect it to engineering velocity, and secure agreement for a POC with the affected teams.',
                systemPrompt: `You are roleplaying as TWO personas simultaneously in a sales call at Figma:

1. **Sarah Chen - VP of Engineering at Figma**
2. **Marcus Rodriguez - Head of Security at Figma**

THE SCENARIO:
- A Cursor AE has requested this call
- You've noticed some engineers using Cursor without approval
- Your initial stance: hostile/concerned about security, want to remove Cursor immediately
- You claim ignorance about what Cursor does and what value GitHub Copilot provides
- You're skeptical and dismissive initially

THE HIDDEN CONTEXT (only reveal through good discovery):
- Figma is going through a major engineering reorganization
- Teams are being restructured, new projects spinning up
- Engineering velocity has been a concern during this transition
- Some engineers found Cursor on their own and productivity improved
- But you haven't connected these dots yet - the rep needs to help you see it

YOUR BEHAVIOR:
- Start cold and hostile about the security concern
- Switch between Sarah (eng productivity angle) and Marcus (security angle) naturally
- Make the rep work to get information out of you
- Drop subtle hints about the reorg only if they ask good discovery questions about:
  - Current engineering challenges
  - Recent organizational changes
  - Why engineers might have sought out Cursor on their own
  - What problems the team is facing
- Push back on everything initially
- Only warm up if the rep demonstrates they understand your pain and can help
- If they connect Cursor to solving reorg velocity issues, become interested in a POC

WHEN TO END:
- If the rep gets defensive or just pitches features: stay cold, end call uninterested
- If the rep discovers the reorg pain and positions Cursor as a solution: agree to a POC/pilot
- Signal clearly whether you'd move forward or not

FORMAT YOUR RESPONSES:
Use this format to show both personas:
**[Sarah - VP Eng]:** [her dialogue]
**[Marcus - Security]:** [his dialogue]

Start the call hostile and skeptical about Cursor being a security risk.`,
                startMessage: 'Start the call. The Cursor AE has just joined the Zoom call with you both.'
            },
            
            anthropic: {
                id: 'anthropic',
                company: 'Anthropic',
                companyDescription: 'Enterprise AI platform (Claude)',
                difficulty: 'hard',
                description: 'Convince a skeptical CTO who believes AI is hype and that their existing vendor relationships are sufficient. Uncover concerns about AI governance and compliance.',
                targetAccount: 'Fortune 500 Financial Services Company',
                personas: [
                    { name: 'David Park', role: 'CTO' },
                    { name: 'Jennifer Liu', role: 'VP of Enterprise Architecture' }
                ],
                yourRole: 'Enterprise Account Executive at Anthropic',
                initialStance: 'Skeptical - thinks AI is overhyped, happy with existing vendors (OpenAI/Azure)',
                hiddenContext: 'Their board mandated an AI governance policy after a data leak incident. They need a partner who takes safety seriously, but they don\'t trust AI vendors yet. Also concerned about vendor lock-in.',
                successCriteria: 'Discover the governance mandate and data leak incident, position Claude\'s safety approach as differentiated, and get agreement to review your enterprise security documentation.',
                systemPrompt: `You are roleplaying as TWO personas simultaneously in a sales call at a Fortune 500 financial services company:

1. **David Park - CTO**
2. **Jennifer Liu - VP of Enterprise Architecture**

THE SCENARIO:
- An Anthropic AE requested this call after a warm intro from a mutual connection
- You're skeptical about AI - think it's overhyped
- You already use OpenAI/Azure for some pilots
- Your initial stance: defensive, dismissive of "yet another AI vendor"

THE HIDDEN CONTEXT (only reveal through good discovery):
- Your board mandated a strict AI governance policy 3 months ago
- This came after a minor data leak incident involving an AI tool
- You need a partner who takes safety, compliance, and governance seriously
- You're concerned about vendor lock-in and want flexibility
- You don't trust AI vendors - they all claim to be "safe and responsible"

YOUR BEHAVIOR:
- Start dismissive: "We already have OpenAI, why do we need another AI vendor?"
- Push back on any generic AI pitch
- David focuses on technical architecture and vendor lock-in concerns
- Jennifer focuses on governance, compliance, and risk management
- Drop hints about the governance mandate only if they ask about:
  - Current challenges with AI adoption
  - Board or compliance requirements
  - What's holding back broader AI deployment
  - Security or data governance concerns
- Only warm up if they differentiate on safety/governance (not just "better model")
- If they discover the governance need and position Anthropic appropriately, agree to review security docs

FORMAT YOUR RESPONSES:
**[David - CTO]:** [his dialogue]
**[Jennifer - VP Arch]:** [her dialogue]

Start skeptical and dismissive.`,
                startMessage: 'Start the call. The Anthropic AE has just joined the Zoom call.'
            },

            baseten: {
                id: 'baseten',
                company: 'Baseten',
                companyDescription: 'AI infrastructure & deployment platform',
                difficulty: 'medium',
                description: 'Convert a VP of Engineering who is frustrated with their current ML infrastructure. They\'re spending too much time on infrastructure instead of shipping features.',
                targetAccount: 'Series B Consumer App ($200M valuation)',
                personas: [
                    { name: 'Alex Kumar', role: 'VP of Engineering' },
                    { name: 'Rachel Torres', role: 'ML Platform Lead' }
                ],
                yourRole: 'Account Executive at Baseten',
                initialStance: 'Frustrated but not urgent - currently using a mix of self-hosted and managed solutions',
                hiddenContext: 'They\'re about to launch a major AI feature that\'s 2 months behind schedule. Their ML team is drowning in infrastructure work. CEO is pressuring them to ship faster.',
                successCriteria: 'Discover the delayed feature launch and resource constraints, position Baseten as enabling faster iteration, and secure a technical evaluation with the ML team.',
                systemPrompt: `You are roleplaying as TWO personas in a sales call at a Series B consumer app:

1. **Alex Kumar - VP of Engineering**
2. **Rachel Torres - ML Platform Lead**

THE SCENARIO:
- A Baseten AE requested this call after seeing you're hiring ML infrastructure engineers
- You're frustrated with your current setup (mix of self-hosted models and AWS Bedrock)
- Initial stance: interested but not urgent, skeptical about "yet another platform"

THE HIDDEN CONTEXT (only reveal through good discovery):
- You're launching a major AI-powered feature that's 2 months behind schedule
- Your small ML team (3 people) is spending 70% of time on infrastructure
- CEO is frustrated about slow AI feature velocity
- You just got approved to hire 2 more ML engineers, but can't find good candidates
- The real problem: need to ship AI features faster with current team

YOUR BEHAVIOR:
- Start by explaining your current setup (some self-hosted, some Bedrock)
- Alex is focused on shipping velocity and team efficiency
- Rachel is deep in the infrastructure pain, but defensive about their choices
- Be somewhat open but not desperate
- Drop hints about the delayed launch only if they ask about:
  - Current AI initiatives or roadmap
  - Team structure and resources
  - What's slowing down AI development
  - Infrastructure pain points
- Warm up if they focus on "ship faster with fewer people" not just "better infrastructure"
- If they connect Baseten to solving the velocity problem, agree to a technical eval

FORMAT YOUR RESPONSES:
**[Alex - VP Eng]:** [his dialogue]
**[Rachel - ML Lead]:** [her dialogue]

Start somewhat interested but not urgent.`,
                startMessage: 'Start the call. The Baseten AE has just joined the Zoom call.'
            },

            'baseten-abridge': {
                id: 'baseten-abridge',
                company: 'Baseten',
                companyDescription: 'AI infrastructure & deployment platform',
                difficulty: 'hard',
                description: 'Navigate a discovery call with Abridge\'s technical leaders who are dealing with reliability issues and infrastructure bottlenecks after raising $300M Series E.',
                targetAccount: 'Abridge (Healthcare AI - $300M Series E)',
                personas: [
                    { name: 'Dr. Priya Sharma', role: 'Head of Engineering' },
                    { name: 'James Chen', role: 'ML/AI Engineering Lead' }
                ],
                yourRole: 'Account Executive at Baseten',
                initialStance: 'Cautiously interested but protective of their AWS setup. They\'ve invested heavily in GPU reservations and are skeptical of switching platforms. Frustrated with recent reliability issues but unsure if a new platform is the answer.',
                hiddenContext: 'Abridge\'s ML team is spending 60% of their time on infrastructure instead of improving transcription accuracy. The reliability issues are causing doctors to lose trust in the product. Their AWS GPU costs are $400K/month and growing. The CTO is pressuring them to show ROI on the Series E funding by improving model performance, but the team is stuck firefighting infrastructure problems. They\'re also evaluating competitive solutions but haven\'t told anyone yet.',
                successCriteria: 'Discover the infrastructure time-sink and cost issues. Connect Baseten to freeing up ML team for model work. Uncover that they\'re evaluating competitors. Secure agreement for a technical deep-dive with the ML team next week.',
                systemPrompt: `You are roleplaying as TWO personas in a discovery call at Abridge (healthcare AI transcription company):

1. **Dr. Priya Sharma - Head of Engineering**
2. **James Chen - ML/AI Engineering Lead**

THE SCENARIO:
- A Baseten AE requested this 20-minute discovery call
- Abridge just raised $300M Series E to scale clinical transcription AI
- You're built on AWS with several GPU reservations
- You've had reliability issues recently that are causing customer complaints
- You're curious if Baseten has done model performance work for transcription/audio models
- Initial stance: Interested but skeptical - you've invested a lot in AWS

THE HIDDEN CONTEXT (only reveal through good discovery):
- Your ML team spends 60% of time on infrastructure vs. model improvements
- AWS GPU costs are $400K/month and growing rapidly
- Recent reliability issues are making doctors lose trust in your product
- CTO is pressuring you to show ROI from Series E by improving accuracy
- But you're stuck firefighting infrastructure instead of iterating on models
- You're quietly evaluating competitive solutions (haven't told Baseten yet)
- The real pain: Can't improve the product because you're managing infrastructure

YOUR BEHAVIOR:
- Priya focuses on: business impact, team productivity, strategic direction
- James focuses on: technical details, ML infrastructure pain, model performance
- Start somewhat guarded - you don't want to admit you're struggling
- Drop hints about infrastructure time-sink only if they ask about team allocation
- Reveal cost concerns if they ask about current setup/challenges
- Mention competitive evaluation only if they ask "what else are you looking at?"
- Get genuinely interested if they connect Baseten to: faster model iteration, team productivity, or reliability

WHEN TO WARM UP:
- If rep discovers you're spending too much time on infra
- If they position Baseten as "free your ML team to focus on models"
- If they understand the reliability issues are infrastructure-related, not model-related
- If they ask insightful questions about your competitive advantage (model accuracy)

WHEN TO END:
- If rep just pitches features without discovery: stay polite but uninterested
- If rep discovers the pain and positions value well: agree to technical deep-dive
- Signal clearly whether you'd move forward

FORMAT YOUR RESPONSES:
**[Priya - Head of Eng]:** [her dialogue]
**[James - ML Lead]:** [his dialogue]

Start somewhat skeptical but professional.`,
                startMessage: 'Start the call. The Baseten AE has just joined. Priya and James introduce themselves briefly and express cautious interest.'
            },

            // OUTBOUND SALES PRACTICE SCENARIOS
            'outbound-vp-engineering': {
                id: 'outbound-vp-engineering',
                company: 'Your Product',
                companyDescription: 'Practice outbound cold calling',
                difficulty: 'medium',
                description: 'Practice cold calling a skeptical VP of Engineering who hates being sold to. Navigate objections and discover their velocity challenges.',
                targetAccount: 'Mid-size SaaS Company',
                personas: [
                    { name: 'Alex Chen', role: 'VP of Engineering' }
                ],
                yourRole: 'Outbound Sales Rep (any product)',
                initialStance: 'Cold and skeptical - "How did you get my number?" Protective of team time and budget.',
                hiddenContext: 'Team under pressure to ship faster without hiring. Recent engineering manager departure. Board wants more features with same headcount.',
                successCriteria: 'Earn a follow-up meeting through good discovery. Uncover velocity/headcount challenges. Position your solution as low-risk.',
                systemPrompt: `You are Alex Chen, VP of Engineering at a mid-size SaaS company (400 employees, Series C funded).

PERSONALITY & BACKGROUND:
- Skeptical and direct - you hate being sold to
- Technical background (former senior engineer)
- Budget-conscious after recent headcount freeze
- Protective of your team's time and focus
- You've seen every sales pitch and can smell BS

CURRENT SITUATION:
- Your team uses a mix of tools, some work well, some don't
- You're under pressure to increase velocity without hiring
- Recent engineering manager left, causing team disruption
- Board wants more shipped features with same resources

YOUR BEHAVIOR ON THIS CALL:
- Start cold and skeptical: "How did you get my number?"
- Push back on claims: "We already have a solution for that"
- Test the caller's technical knowledge
- Ask tough questions: "What's this actually going to cost us in time and money?"
- Throw common objections: "Too expensive", "Not the right time", "Send me info"

WHAT MAKES YOU WARM UP:
- Caller asks about YOUR challenges (not pitching immediately)
- They understand engineering velocity and team dynamics
- They acknowledge your budget constraints
- They offer a low-risk way to validate value (small pilot, specific team)
- They speak technically but not condescendingly

WHAT TURNS YOU OFF:
- Generic sales pitches
- Pushy behavior or pressure tactics
- Claims without proof
- "Everyone is using this" type statements
- Asking for big commitments upfront

KEEP RESPONSES BRIEF (2-3 sentences). Sound busy and slightly impatient.

GOAL: Make them EARN a follow-up meeting through excellent discovery and positioning.`,
                startMessage: 'The phone rings. You answer: "Alex Chen." (Keep it short and slightly cold)'
            },

            'outbound-head-of-sales': {
                id: 'outbound-head-of-sales',
                company: 'Your Product',
                companyDescription: 'Practice outbound cold calling',
                difficulty: 'medium',
                description: 'Practice cold calling a busy Head of Sales who demands ROI proof and has zero patience for rambling.',
                targetAccount: 'B2B Enterprise Software Company',
                personas: [
                    { name: 'Jordan Martinez', role: 'Head of Sales' }
                ],
                yourRole: 'Outbound Sales Rep (any product)',
                initialStance: 'Extremely busy and impatient - "I have 5 minutes, what is this about?" Will hang up if you waste time.',
                hiddenContext: 'Team missing quota by 15%. New reps take 4-6 months to ramp. CEO pressuring for better forecast accuracy. Considering cutting underperformers vs. investing in training.',
                successCriteria: 'Prove value in under 3 minutes. Speak in metrics (revenue, quota, ramp time). Earn permission for a follow-up conversation.',
                systemPrompt: `You are Jordan Martinez, Head of Sales at a B2B enterprise software company (80-person sales team, $50M ARR).

PERSONALITY & BACKGROUND:
- Direct, no-nonsense, numbers-driven
- Extremely busy (always in back-to-back meetings)
- Success measured by pipeline, win rate, and ramp time
- Low tolerance for wasted time
- Respect people who are prepared and efficient

CURRENT SITUATION:
- Your team is missing quota by 15% this quarter
- New reps take 4-6 months to ramp (too slow)
- You're evaluating sales enablement and training tools
- CEO is pressuring you to improve forecast accuracy
- Considering cutting underperformers vs. investing in training

YOUR BEHAVIOR ON THIS CALL:
- Start rushed: "I have 5 minutes, what is this about?"
- Demand quick ROI answers: "What's the bottom line?"
- Interrupt if they're not getting to the point
- Ask: "How much does this cost and what's the payback period?"
- Test their research: "Do you even know what we sell?"

COMMON OBJECTIONS:
- "We already have Gong/Chorus/Salesforce"
- "Send me a one-pager and I'll review it"
- "What's the ROI? Show me the data"
- "My team doesn't have time to learn another tool"
- "I need to think about it"

WHAT MAKES YOU WARM UP:
- Caller did research on your company
- They ask about YOUR specific sales challenges
- They speak in metrics (revenue, quota attainment, ramp time)
- They offer a fast, quantifiable pilot
- They respect your time and get to value quickly

WHAT TURNS YOU OFF:
- Long-winded explanations
- Feature dumps without business outcomes
- Theoretical benefits without proof
- "Let me tell you about our company" intros
- Asking for 60-minute demos

KEEP RESPONSES VERY BRIEF (1-2 sentences). Sound impatient. Cut people off if they ramble.

GOAL: Force them to prove value in under 3 minutes or you'll end the call.`,
                startMessage: 'The phone rings. You answer quickly: "Jordan Martinez, make it quick." (Sound rushed)'
            },

            'outbound-cto': {
                id: 'outbound-cto',
                company: 'Your Product',
                companyDescription: 'Practice outbound cold calling',
                difficulty: 'hard',
                description: 'Practice cold calling a strategic CTO at a FinTech startup who cares about security, architecture, and vendor lock-in.',
                targetAccount: 'FinTech Startup (Series B)',
                personas: [
                    { name: 'Sam Williams', role: 'CTO' }
                ],
                yourRole: 'Outbound Sales Rep (any product)',
                initialStance: 'Cautious and strategic - "I don\'t remember scheduling this call." Prefers building in-house. Vendor fatigue.',
                hiddenContext: 'Building new payments platform (9 months). Recent security audit revealed technical debt. Board wants faster innovation but can\'t compromise security. Evaluating build vs. buy decisions.',
                successCriteria: 'Demonstrate understanding of FinTech/regulated industries. Address security/compliance upfront. Position as strategic partner, not vendor. Earn technical deep-dive.',
                systemPrompt: `You are Sam Williams, CTO at a FinTech startup (Series B, 120 employees, heavily regulated industry).

PERSONALITY & BACKGROUND:
- Strategic thinker focused on architecture and scalability
- Security and compliance are top priorities
- Skeptical of vendor claims (been burned before)
- Prefer to build in-house when possible
- Value long-term partnerships over quick wins

CURRENT SITUATION:
- Building a new payments platform (9-month project)
- Recent security audit revealed some technical debt
- Board wants faster innovation but you can't compromise security
- You're evaluating build vs. buy for several components
- Vendor fatigue - too many sales calls

YOUR BEHAVIOR ON THIS CALL:
- Start cautious: "I don't remember scheduling this call"
- Ask strategic questions: "How does this fit our architecture?"
- Dig into security: "What's your SOC 2 status? Data residency?"
- Challenge integration claims: "What does implementation actually look like?"
- Consider alternatives: "We're already building something similar internally"

COMMON OBJECTIONS:
- "We prefer to build this in-house"
- "What about vendor lock-in?"
- "How does this integrate with our existing stack?"
- "What if your company gets acquired?"
- "Security and compliance are deal-breakers for us"
- "We need to see the architecture diagrams first"

WHAT MAKES YOU WARM UP:
- Caller understands FinTech/regulated industries
- They ask about your technical strategy and constraints
- They acknowledge security/compliance requirements upfront
- They're transparent about limitations
- They position as a partner, not just a vendor
- They can speak to technical architecture

WHAT TURNS YOU OFF:
- Dismissing your build-in-house considerations
- Overpromising on integrations
- Lack of security/compliance documentation
- Pressure to move fast without due diligence
- Sales reps who can't answer technical questions

KEEP RESPONSES THOUGHTFUL BUT CONCISE (2-3 sentences). Sound analytical and measured.

GOAL: Test if they understand strategic technology decisions and regulated industries.`,
                startMessage: 'The phone rings. You answer: "Sam Williams speaking." (Professional but guarded)'
            }
        };

        function App() {
            const [currentView, setCurrentView] = useState('home'); // 'home', 'briefing', 'session', 'feedback'
            const [selectedScenario, setSelectedScenario] = useState(null);
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [feedback, setFeedback] = useState('');
            const [useVoiceMode, setUseVoiceMode] = useState(false);
            const [isCallActive, setIsCallActive] = useState(false);
            const [callStatus, setCallStatus] = useState('idle'); // 'idle', 'connecting', 'active', 'ended'
            const messagesEndRef = useRef(null);
            const conversationHistory = useRef([]);
            const vapiInstance = useRef(null);
            const selectedScenarioRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // Keep selectedScenarioRef in sync with selectedScenario state
            useEffect(() => {
                selectedScenarioRef.current = selectedScenario;
            }, [selectedScenario]);

            // Initialize Vapi SDK
            useEffect(() => {
                if (typeof Vapi !== 'undefined') {
                    vapiInstance.current = new Vapi('ae73bb58-cfcd-497d-a9df-e47f3b3b825b');

                    // Set up event listeners
                    vapiInstance.current.on('call-start', () => {
                        setCallStatus('active');
                        setIsCallActive(true);
                        setMessages(prev => [...prev, {
                            speaker: 'System',
                            content: 'Voice call started. Start speaking!',
                            isUser: false
                        }]);
                    });

                    vapiInstance.current.on('call-end', () => {
                        setCallStatus('ended');
                        setIsCallActive(false);
                        setMessages(prev => [...prev, {
                            speaker: 'System',
                            content: 'Voice call ended.',
                            isUser: false
                        }]);
                    });

                    vapiInstance.current.on('speech-start', () => {
                        console.log('User started speaking');
                    });

                    vapiInstance.current.on('speech-end', () => {
                        console.log('User stopped speaking');
                    });

                    vapiInstance.current.on('message', (message) => {
                        console.log('Vapi message:', message);

                        // Handle transcript messages
                        if (message.type === 'transcript' && message.transcript) {
                            const isUser = message.role === 'user';
                            const scenario = selectedScenarioRef.current;

                            // Add null check to prevent errors if scenario becomes null
                            if (scenario) {
                                setMessages(prev => [...prev, {
                                    speaker: isUser ? `You (${scenario.company} AE)` : `${scenario.targetAccount} Team`,
                                    content: message.transcript,
                                    isUser: isUser
                                }]);
                            } else {
                                // Fallback if scenario is null
                                setMessages(prev => [...prev, {
                                    speaker: isUser ? 'You' : 'AI',
                                    content: message.transcript,
                                    isUser: isUser
                                }]);
                            }
                        }
                    });

                    vapiInstance.current.on('error', (error) => {
                        console.error('Vapi error:', error);
                        setMessages(prev => [...prev, {
                            speaker: 'System',
                            content: `Error: ${error.message || 'Voice call error occurred'}`,
                            isUser: false
                        }]);
                    });
                }

                return () => {
                    if (vapiInstance.current) {
                        vapiInstance.current.stop();
                    }
                };
            }, []);

            const startVoiceCall = async () => {
                if (!vapiInstance.current || !selectedScenario) return;

                setCallStatus('connecting');
                setIsLoading(true);

                // Create voice-specific system prompt with conversational instructions
                const voiceSystemPrompt = `${selectedScenario.systemPrompt}

CRITICAL VOICE MODE INSTRUCTIONS:
- Speak as ONE persona at a time (either ${selectedScenario.personas[0].name} OR ${selectedScenario.personas[1].name}, NEVER both simultaneously)
- Keep each response to 2-3 sentences maximum
- Be conversational and natural - this is voice, not text chat
- Use a natural speaking style without formatting markers like **[Name]:** or asterisks
- The other persona should only jump in when they have something specifically relevant to add to the conversation
- Switch personas naturally when appropriate, but don't force both to speak every turn
- Respond quickly and concisely - avoid long explanations or verbose answers`;

                try {
                    // Start call with inline assistant configuration
                    await vapiInstance.current.start({
                        model: {
                            provider: "openai",
                            model: "gpt-4",
                            messages: [
                                {
                                    role: "system",
                                    content: voiceSystemPrompt
                                }
                            ]
                        },
                        voice: {
                            provider: "11labs",
                            voiceId: "21m00Tcm4TlvDq8ikWAM" // Default professional voice
                        },
                        firstMessage: selectedScenario.startMessage,
                        recordingEnabled: true
                    });
                } catch (error) {
                    console.error('Failed to start voice call:', error);
                    setCallStatus('idle');
                    setMessages(prev => [...prev, {
                        speaker: 'System',
                        content: 'Failed to start voice call. Please try again.',
                        isUser: false
                    }]);
                }

                setIsLoading(false);
            };

            const stopVoiceCall = () => {
                if (vapiInstance.current) {
                    vapiInstance.current.stop();
                }
            };

            const selectScenario = (scenarioId) => {
                setSelectedScenario(SCENARIOS[scenarioId]);
                setCurrentView('briefing');
            };

            const startSession = async () => {
                
                setCurrentView('session');
                setIsLoading(true);

                try {
                    const response = await fetch("/api/chat", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            system: selectedScenario.systemPrompt,
                            messages: [
                                {
                                    role: "user",
                                    content: selectedScenario.startMessage
                                }
                            ],
                        })
                    });

                    const data = await response.json();
                    const aiMessage = data.content[0].text;

                    conversationHistory.current = [
                        { role: "user", content: selectedScenario.startMessage },
                        { role: "assistant", content: aiMessage }
                    ];

                    setMessages([
                        {
                            speaker: `${selectedScenario.targetAccount} Team`,
                            content: aiMessage,
                            isUser: false
                        }
                    ]);
                } catch (error) {
                    console.error("Error:", error);
                    setMessages([
                        {
                            speaker: "System",
                            content: "Error starting session. Please check console.",
                            isUser: false
                        }
                    ]);
                }

                setIsLoading(false);
            };

            const sendMessage = async () => {
                if (!inputValue.trim() || isLoading) return;

                const userMessage = inputValue;
                setInputValue('');
                setIsLoading(true);

                setMessages(prev => [...prev, {
                    speaker: `You (${selectedScenario.company} AE)`,
                    content: userMessage,
                    isUser: true
                }]);

                conversationHistory.current.push({
                    role: "user",
                    content: userMessage
                });

                try {
                    const response = await fetch("/api/chat", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            system: selectedScenario.systemPrompt,
                            messages: conversationHistory.current,
                        })
                    });

                    const data = await response.json();
                    const aiMessage = data.content[0].text;

                    conversationHistory.current.push({
                        role: "assistant",
                        content: aiMessage
                    });

                    setMessages(prev => [...prev, {
                        speaker: `${selectedScenario.targetAccount} Team`,
                        content: aiMessage,
                        isUser: false
                    }]);
                } catch (error) {
                    console.error("Error:", error);
                    setMessages(prev => [...prev, {
                        speaker: "System",
                        content: "Error sending message. Please try again.",
                        isUser: false
                    }]);
                }

                setIsLoading(false);
            };

            const endSession = async () => {
                setIsLoading(true);
                setCurrentView('feedback');

                try {
                    const response = await fetch("/api/chat", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [
                                {
                                    role: "user",
                                    content: `You just finished roleplaying as buyer personas in a ${selectedScenario.company} sales call.

Scenario: ${selectedScenario.description}
Target Account: ${selectedScenario.targetAccount}
Hidden Context: ${selectedScenario.hiddenContext}
Success Criteria: ${selectedScenario.successCriteria}

Here's the full conversation:

${conversationHistory.current.map(msg => 
    `${msg.role === 'user' ? selectedScenario.company.toUpperCase() + ' AE' : selectedScenario.targetAccount.toUpperCase() + ' TEAM'}: ${msg.content}`
).join('\n\n')}

Now provide honest, direct feedback as if you're the ${selectedScenario.company} sales leader debriefing this rep:

1. **Outcome**: Would the buyers move forward? Why or why not?

2. **What worked**: What did the rep do well? Specific examples.

3. **What didn't work**: Where did they miss opportunities or make mistakes?

4. **Discovery quality**: Did they uncover the hidden context (${selectedScenario.hiddenContext})? How well did they connect it to ${selectedScenario.company}'s value?

5. **Key lesson**: One specific thing to do differently next time.

Be direct and honest. This is coaching, not a compliment sandwich.`
                                }
                            ],
                        })
                    });

                    const data = await response.json();
                    setFeedback(data.content[0].text);
                } catch (error) {
                    console.error("Error:", error);
                    setFeedback("Error generating feedback. Please try again.");
                }

                setIsLoading(false);
            };

            const resetToHome = () => {
                // Stop any active voice call
                if (vapiInstance.current && isCallActive) {
                    vapiInstance.current.stop();
                }

                setCurrentView('home');
                setSelectedScenario(null);
                setMessages([]);
                setInputValue('');
                setFeedback('');
                setUseVoiceMode(false);
                setIsCallActive(false);
                setCallStatus('idle');
                conversationHistory.current = [];
            };

            // HOME VIEW
            if (currentView === 'home') {
                return (
                    <div className="container">
                            <div className="header">
                                <h1>Sales Interview Prep</h1>
                                <p>Master adversarial roleplays for top B2B sales positions. Practice discovery, objection handling, and closing under pressure.</p>
                            </div>

                            <div className="scenarios-grid">
                            {Object.values(SCENARIOS).map(scenario => (
                                <div 
                                    key={scenario.id} 
                                    className="scenario-card"
                                    onClick={() => selectScenario(scenario.id)}
                                >
                                    <div className="scenario-header">
                                        <div className="company-name">{scenario.company}</div>
                                        <div className={`difficulty-badge difficulty-${scenario.difficulty}`}>
                                            {scenario.difficulty.toUpperCase()}
                                        </div>
                                    </div>

                                    <div className="scenario-description">
                                        {scenario.description}
                                    </div>

                                    <div className="scenario-details">
                                        <div className="detail-item">
                                            <span className="detail-label">Your Role:</span>
                                            <span className="detail-value">{scenario.yourRole}</span>
                                        </div>
                                        <div className="detail-item">
                                            <span className="detail-label">Account:</span>
                                            <span className="detail-value">{scenario.targetAccount}</span>
                                        </div>
                                        <div className="detail-item">
                                            <span className="detail-label">Personas:</span>
                                            <span className="detail-value">
                                                {scenario.personas.map(p => p.role).join(', ')}
                                            </span>
                                        </div>
                                    </div>

                                    <button className="start-button">
                                        Start Scenario 
                                    </button>
                                </div>
                            ))}
                        </div>

                        <div style={{marginTop: '60px', textAlign: 'center'}}>
                            <h2 style={{fontSize: '2rem', marginBottom: '20px', color: '#fff'}}>
                                 Practice Outbound Cold Calls
                            </h2>
                            <p style={{color: '#999', fontSize: '1.1rem', marginBottom: '30px', maxWidth: '700px', margin: '0 auto 30px'}}>
                                Want realistic phone practice? Call our AI practice line and roleplay with different buyer personas.
                            </p>

                            <div className="briefing-section" style={{maxWidth: '900px', margin: '0 auto'}}>
                                <div className="briefing-box">
                                    <h3> How It Works</h3>
                                    <p style={{marginBottom: '15px'}}>Call the number below and practice outbound cold calling with three challenging buyer personas:</p>
                                    <div className="personas-grid">
                                        <div className="persona-card">
                                            <div className="persona-name">Alex Chen</div>
                                            <div className="persona-role">VP of Engineering - Skeptical & Technical</div>
                                        </div>
                                        <div className="persona-card">
                                            <div className="persona-name">Jordan Martinez</div>
                                            <div className="persona-role">Head of Sales - Busy & Impatient</div>
                                        </div>
                                        <div className="persona-card">
                                            <div className="persona-name">Sam Williams</div>
                                            <div className="persona-role">CTO - Strategic & Security-Focused</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="info-box">
                                    <h3 style={{color: '#fff', marginBottom: '15px', fontSize: '1.3rem'}}> Practice Line</h3>
                                    <p style={{fontSize: '2rem', fontWeight: '700', color: '#667eea', fontFamily: 'monospace', marginBottom: '15px'}}>
                                        +1 (415) 231-1765
                                    </p>
                                    <p style={{fontSize: '0.9rem', color: '#999'}}>
                                        Call anytime. Choose your persona. Practice realistic cold calls.
                                    </p>
                                </div>

                                <div className="briefing-box">
                                    <h3> What You'll Practice</h3>
                                    <ul>
                                        <li><strong>Opening lines</strong> - Get past the gatekeeper (yourself!)</li>
                                        <li><strong>Discovery questions</strong> - Uncover hidden pain points</li>
                                        <li><strong>Objection handling</strong> - Navigate "not interested", "too busy", "we already have a solution"</li>
                                        <li><strong>Earning the meeting</strong> - Turn skepticism into interest</li>
                                        <li><strong>Tonality & pacing</strong> - Practice sounding confident, not pushy</li>
                                    </ul>
                                </div>

                                <div className="briefing-box">
                                    <h3> Call Flow</h3>
                                    <p><strong>Step 1:</strong> Dial the number above</p>
                                    <p><strong>Step 2:</strong> AI answers: "Which persona? VP of Engineering, Head of Sales, or CTO?"</p>
                                    <p><strong>Step 3:</strong> Choose your persona</p>
                                    <p><strong>Step 4:</strong> Practice your cold call (5-10 minutes)</p>
                                    <p><strong>Step 5:</strong> Hang up and reflect on what worked/didn't work</p>
                                </div>

                                <div className="warning">
                                    <strong> These personas are TOUGH</strong>
                                    <p>They'll hang up if you ramble, challenge your claims, and throw real objections. This is as realistic as it gets.</p>
                                </div>
                            </div>
                        </div>

                        <div className="info-box" style={{marginTop: '60px'}}>
                            <strong>How it works:</strong> Select a scenario, review the briefing, then jump into a live roleplay with AI buyers who challenge you realistically. End the call to get detailed feedback on your performance.
                        </div>
                    </div>
                );
            }

            // BRIEFING VIEW
            if (currentView === 'briefing') {
                return (
                    <div className="container">
                        <button className="back-button" onClick={resetToHome}>
                             Back to Scenarios
                        </button>

                        <div className="briefing-section">
                            <div className="briefing-header">
                                <h2>{selectedScenario.company} - Pre-Call Briefing</h2>
                                <p>Review this information before starting the roleplay</p>
                            </div>

                            <div className="briefing-box">
                                <h3>Your Role</h3>
                                <p>{selectedScenario.yourRole}</p>
                            </div>

                            <div className="briefing-box">
                                <h3>Target Account</h3>
                                <p><strong>{selectedScenario.targetAccount}</strong></p>
                            </div>

                            <div className="briefing-box">
                                <h3>Who You're Meeting</h3>
                                <div className="personas-grid">
                                    {selectedScenario.personas.map((persona, idx) => (
                                        <div key={idx} className="persona-card">
                                            <div className="persona-name">{persona.name}</div>
                                            <div className="persona-role">{persona.role}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="briefing-box">
                                <h3>Initial Buyer Stance</h3>
                                <p>{selectedScenario.initialStance}</p>
                            </div>

                            <div className="briefing-box">
                                <h3>Your Challenge</h3>
                                <p>{selectedScenario.description}</p>
                            </div>

                            <div className="briefing-box">
                                <h3>Success Criteria</h3>
                                <p>{selectedScenario.successCriteria}</p>
                            </div>

                            <div className="warning">
                                <strong> Hidden Context</strong>
                                <p>There's critical information the buyers won't volunteer. You'll need strong discovery to uncover it. The roleplay AI knows this context but won't reveal it unless you ask the right questions.</p>
                            </div>

                            <div className="info-box">
                                <strong>Choose Your Mode:</strong>
                                <div className="mode-toggle">
                                    <button
                                        className={`mode-button ${!useVoiceMode ? 'active' : ''}`}
                                        onClick={() => setUseVoiceMode(false)}
                                    >
                                         Text Chat
                                    </button>
                                    <button
                                        className={`mode-button ${useVoiceMode ? 'active' : ''}`}
                                        onClick={() => setUseVoiceMode(true)}
                                    >
                                         Voice Call
                                    </button>
                                </div>
                                <p style={{marginTop: '15px', textAlign: 'center', fontSize: '0.9rem'}}>
                                    {useVoiceMode ? 'Practice with realistic voice conversations' : 'Practice with text-based roleplay'}
                                </p>
                            </div>

                            <button className="start-button" onClick={useVoiceMode ? () => { setCurrentView('session'); startVoiceCall(); } : startSession}>
                                Start Roleplay 
                            </button>
                        </div>
                    </div>
                );
            }

            // SESSION VIEW
            if (currentView === 'session') {
                return (
                    <div className="container">
                        <button className="back-button" onClick={resetToHome}>
                             Exit & Return Home
                        </button>

                        <div className="header">
                            <h1>Live Call - {selectedScenario.targetAccount}</h1>
                            <p>{selectedScenario.successCriteria}</p>
                            {useVoiceMode && (
                                <div className="voice-status" style={{justifyContent: 'center', marginTop: '15px'}}>
                                    <div className={`voice-indicator ${isCallActive ? 'active' : ''}`}></div>
                                    <span>{callStatus === 'connecting' ? 'Connecting...' : callStatus === 'active' ? 'Voice Call Active' : callStatus === 'ended' ? 'Call Ended' : 'Ready to Call'}</span>
                                </div>
                            )}
                        </div>

                        {useVoiceMode ? (
                            // Voice Mode UI
                            <div className="chat-container">
                                <div className="chat-header">
                                    <h3>Voice Interview Session</h3>
                                    <div className="participants">
                                        {selectedScenario.personas.map((persona, idx) => (
                                            <div key={idx} className="participant">
                                                {persona.name} - {persona.role}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="voice-controls">
                                    <button
                                        className={`voice-button ${isCallActive ? 'active' : ''}`}
                                        onClick={isCallActive ? stopVoiceCall : startVoiceCall}
                                        disabled={isLoading}
                                    >
                                        {isLoading ? ' Connecting...' : isCallActive ? ' End Call' : ' Start Voice Call'}
                                    </button>

                                    <p style={{color: '#999', textAlign: 'center', maxWidth: '600px'}}>
                                        {isCallActive ?
                                            'Speak naturally into your microphone. The AI buyers will respond with voice.' :
                                            'Click the button above to start a realistic voice conversation with the AI buyers.'
                                        }
                                    </p>

                                    {messages.length > 0 && (
                                        <div className="voice-transcript">
                                            <h4 style={{color: '#667eea', marginBottom: '15px'}}>Conversation Transcript</h4>
                                            {messages.map((msg, idx) => (
                                                <div key={idx} className={`transcript-item ${msg.isUser ? 'user' : ''}`}>
                                                    <div className={`transcript-label ${msg.isUser ? 'user' : ''}`}>
                                                        {msg.speaker}
                                                    </div>
                                                    <div style={{color: '#ccc'}}>
                                                        {msg.content}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="input-section">
                                    <button
                                        className="end-button"
                                        onClick={endSession}
                                        disabled={isCallActive}
                                    >
                                        {isCallActive ? 'End Voice Call First' : 'Get Performance Feedback'}
                                    </button>
                                </div>
                            </div>
                        ) : (
                            // Text Mode UI
                            <div className="chat-container">
                            <div className="chat-header">
                                <h3>Sales Call in Progress</h3>
                                <div className="participants">
                                    {selectedScenario.personas.map((persona, idx) => (
                                        <div key={idx} className="participant">
                                            {persona.name} - {persona.role}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="messages">
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`message ${msg.isUser ? 'user' : ''}`}>
                                        <div className="message-header">
                                            <span className={`speaker-name ${msg.isUser ? 'user' : ''}`}>
                                                {msg.speaker}
                                            </span>
                                        </div>
                                        <div className="message-content">
                                            {msg.content}
                                        </div>
                                    </div>
                                ))}
                                {isLoading && (
                                    <div className="message">
                                        <div className="message-content loading">
                                            {selectedScenario.targetAccount} team is responding...
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            <div className="input-section">
                                <div className="input-container">
                                    <textarea
                                        className="message-input"
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault();
                                                sendMessage();
                                            }
                                        }}
                                        placeholder="Type your response... (Shift+Enter for new line)"
                                        disabled={isLoading}
                                    />
                                    <button
                                        className="send-button"
                                        onClick={sendMessage}
                                        disabled={isLoading || !inputValue.trim()}
                                    >
                                        Send
                                    </button>
                                </div>
                                <button className="end-button" onClick={endSession}>
                                    End Call & Get Feedback
                                </button>
                            </div>
                        </div>
                        )}
                    </div>
                );
            }

            // FEEDBACK VIEW
            if (currentView === 'feedback') {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>Session Complete</h1>
                            <p>{selectedScenario.company} - {selectedScenario.targetAccount}</p>
                        </div>

                        <div className="feedback-section">
                            <h2>Performance Feedback</h2>
                            <div className="feedback-content">
                                {isLoading ? (
                                    <p className="loading">Analyzing your performance...</p>
                                ) : (
                                    feedback
                                )}
                            </div>
                        </div>

                        <button className="start-button" onClick={resetToHome}>
                             Back to Scenarios
                        </button>
                    </div>
                );
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>